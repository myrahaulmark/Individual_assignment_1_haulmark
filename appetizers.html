<!DOCTYPE HTML>
<html>
	<head>
		<title>Appetizers - La Mise en Place</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<style>
			/* Additional Styling */
			.search-results {
				margin-top: 20px;
			}

			.recipe-card {
				display: grid;
				grid-template-columns: 2fr 1fr; /* Two columns: details and meta-info */
				gap: 15px;
				padding: 10px;
				border: 1px solid #ddd;
				border-radius: 8px;
				background: #f9f9f9;
				margin-bottom: 15px;
				cursor: pointer;
				transition: box-shadow 0.3s;
			}

			.recipe-card:hover {
				box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
			}

			.recipe-details h3 {
				margin-top: 0;
			}

			.recipe-meta p {
				margin: 5px 0;
			}

			.recipe-container {
				margin-top: 30px;
			}

			.ingredients, .instructions, .reviews {
				margin-bottom: 30px;
			}

			.review {
				border: 1px solid #ddd;
				padding: 10px;
				border-radius: 8px;
				margin-bottom: 10px;
				background: #f9f9f9;
			}
		</style>
	</head>
	<body class="is-preload">

		<!-- Wrapper -->
		<div id="wrapper">

			<!-- Main -->
			<div id="main">
				<div class="inner">

					<!-- Header -->
					<header id="header">
						<a href="index.html" class="logo"><strong>La Mise en Place</strong> Recipe Database</a>
					</header>

					<!-- Search Section -->
					<section>
						<h1>Appetizers</h1>
						<p>Search for delicious appetizer recipes based on ingredients, dietary preferences, or keywords.</p>
						<input type="text" id="search-bar" placeholder="Search appetizers..." />
						<button id="search-button">Search</button>

						<!-- Search Results -->
						<div class="search-results" id="search-results">
							<!-- Recipes will load dynamically here -->
						</div>
					</section>

					<!-- Recipe Display Section -->
					<section class="recipe-container" id="recipe-container" style="display: none;">
						<h2 id="recipe-title"></h2>
						<p id="recipe-description"></p>

						<div class="ingredients">
							<h3>Ingredients</h3>
							<ul id="ingredients-list"></ul>
						</div>

						<div class="instructions">
							<h3>Instructions</h3>
							<ol id="instructions-list"></ol>
						</div>

						<div class="reviews">
							<h3>Reviews</h3>
							<div id="reviews-container"></div>
						</div>

						<button onclick="window.print()">Print Recipe</button>
					</section>
				</div>
			</div>

			<!-- Sidebar -->
			<div id="sidebar">
				<div class="inner">
					
					<!-- Menu -->
					<nav id="menu">
						<header class="major">
							<h2>Menu</h2>
						</header>
						<ul>
							<li><a href="index.html">Homepage</a></li>
							<li><a href="account.html">My Account</a></li>
							<li><a href="appetizers.html" class="active">Appetizers</a></li>
						</ul>
					</nav>
				</div>
			</div>

		</div>

		<!-- Scripts -->
		<script>
			// API Endpoints
			const searchApiUrl = '/api/appetizers/search'; // Adjust based on your backend
			const recipeApiUrl = '/api/recipes/';

			// Search Functionality
			document.getElementById('search-button').addEventListener('click', async () => {
				const query = document.getElementById('search-bar').value;
				const searchResults = document.getElementById('search-results');
				searchResults.innerHTML = 'Loading...';

				try {
					// Fetch search results
					const response = await fetch(`${searchApiUrl}?q=${encodeURIComponent(query)}`);
					const recipes = await response.json();

					// Display results
					if (recipes.length > 0) {
						searchResults.innerHTML = recipes.map(recipe => `
							<div class="recipe-card" onclick="fetchRecipe(${recipe.id})">
								<div class="recipe-details">
									<h3>${recipe.title}</h3>
									<p>${recipe.description}</p>
								</div>
								<div class="recipe-meta">
									<p><strong>Prep Time:</strong> ${recipe.prep_time} mins</p>
									<p><strong>Allergen Warning:</strong> ${recipe.is_allergen ? 'Yes' : 'No'}</p>
								</div>
							</div>
						`).join('');
					} else {
						searchResults.innerHTML = '<p>No recipes found.</p>';
					}
				} catch (error) {
					searchResults.innerHTML = '<p>Error fetching search results.</p>';
				}
			});

			// Fetch and Display Recipe Details
			async function fetchRecipe(recipeId) {
				const recipeContainer = document.getElementById('recipe-container');
				const recipeTitle = document.getElementById('recipe-title');
				const recipeDescription = document.getElementById('recipe-description');
				const ingredientsList = document.getElementById('ingredients-list');
				const instructionsList = document.getElementById('instructions-list');
				const reviewsContainer = document.getElementById('reviews-container');

				recipeContainer.style.display = 'block';

				try {
					// Fetch recipe details
					const recipeResponse = await fetch(`${recipeApiUrl}${recipeId}`);
					const recipeData = await recipeResponse.json();

					// Populate recipe details
					recipeTitle.textContent = recipeData.title;
					recipeDescription.textContent = recipeData.description;

					ingredientsList.innerHTML = recipeData.ingredients
						.map(ingredient => `<li>${ingredient.quantity} ${ingredient.unit} - ${ingredient.name}</li>`)
						.join('');

					instructionsList.innerHTML = recipeData.instructions
						.map(step => `<li>${step}</li>`)
						.join('');

					// Fetch reviews
					const reviewsResponse = await fetch(`${recipeApiUrl}${recipeId}/reviews`);
					const reviewsData = await reviewsResponse.json();

					reviewsContainer.innerHTML = reviewsData.length
						? reviewsData.map(review => `
							<div class="review">
								<strong>${review.user} - ${review.rating}/5</strong>
								<p>${review.review_text}</p>
							</div>
						`).join('')
						: '<p>No reviews yet.</p>';
				} catch (error) {
					recipeContainer.innerHTML = '<p>Error loading recipe details.</p>';
				}
			}
		</script>
	</body>
</html>
