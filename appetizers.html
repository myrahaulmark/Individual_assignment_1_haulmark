<!DOCTYPE HTML>
<html>
	<head>
		<title>Recipe - La Mise en Place</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<style>
			/* Additional styling for recipe details and reviews */
			.recipe-container {
				margin-top: 20px;
			}

			.ingredients, .instructions, .reviews {
				margin-bottom: 30px;
			}

			.reviews h3 {
				margin-bottom: 10px;
			}

			.review {
				border: 1px solid #ddd;
				padding: 10px;
				border-radius: 8px;
				margin-bottom: 10px;
				background: #f9f9f9;
			}

			.review strong {
				display: block;
				margin-bottom: 5px;
			}
		</style>
	</head>
	<body class="is-preload">

		<!-- Wrapper -->
		<div id="wrapper">

			<!-- Main -->
			<div id="main">
				<div class="inner">

					<!-- Header -->
					<header id="header">
						<a href="index.html" class="logo"><strong>La Mise en Place</strong> Recipe Database</a>
						<ul class="icons">
							<li><a href="#" class="icon brands fa-twitter"><span class="label">Twitter</span></a></li>
							<li><a href="#" class="icon brands fa-facebook-f"><span class="label">Facebook</span></a></li>
							<li><a href="#" class="icon brands fa-snapchat-ghost"><span class="label">Snapchat</span></a></li>
							<li><a href="#" class="icon brands fa-instagram"><span class="label">Instagram</span></a></li>
							<li><a href="#" class="icon brands fa-medium-m"><span class="label">Medium</span></a></li>
						</ul>
					</header>

					<!-- Recipe Content -->
					<section class="recipe-container">
						<header class="main">
							<h1 id="recipe-title">Loading recipe...</h1>
						</header>
						<p id="recipe-description"></p>

						<!-- Ingredients -->
						<div class="ingredients">
							<h3>Ingredients</h3>
							<ul id="ingredients-list"></ul>
						</div>

						<!-- Instructions -->
						<div class="instructions">
							<h3>Instructions</h3>
							<ol id="instructions-list"></ol>
						</div>

						<!-- Reviews -->
						<div class="reviews">
							<h3>Reviews</h3>
							<div id="reviews-container">Loading reviews...</div>
						</div>
					</section>

				</div>
			</div>

			<!-- Sidebar -->
			<div id="sidebar">
				<div class="inner">
					
					<!-- Menu -->
					<nav id="menu">
						<header class="major">
							<h2>Menu</h2>
						</header>
						<ul>
							<li><a href="index.html">Homepage</a></li>
							<li><a href="account.html">My Account</a></li>
							<li><a href="appetizers.html" class="active">Appetizers</a></li>
						</ul>
					</nav>

					<!-- Footer -->
					<footer id="footer">
						<p class="copyright">&copy; La Mise en Place. All rights reserved.</p>
					</footer>
				</div>
			</div>

		</div>

		<!-- Scripts -->
		<script>
			// Helper function to get query parameters
			function getQueryParam(param) {
				const urlParams = new URLSearchParams(window.location.search);
				return urlParams.get(param);
			}

			// Fetch recipe and reviews
			async function fetchRecipeData() {
				const recipeId = getQueryParam('id'); // Get recipe ID from URL
				if (!recipeId) {
					document.getElementById('recipe-title').textContent = 'Recipe not found';
					return;
				}

				try {
					// Fetch recipe details
					const recipeResponse = await fetch(`/api/recipes/${recipeId}`);
					const recipeData = await recipeResponse.json();

					// Update recipe details on page
					document.getElementById('recipe-title').textContent = recipeData.title;
					document.getElementById('recipe-description').textContent = recipeData.description;

					// Populate ingredients list
					const ingredientsList = document.getElementById('ingredients-list');
					ingredientsList.innerHTML = recipeData.ingredients
						.map(ingredient => `<li>${ingredient.quantity} ${ingredient.unit} - ${ingredient.name}</li>`)
						.join('');

					// Populate instructions list
					const instructionsList = document.getElementById('instructions-list');
					instructionsList.innerHTML = recipeData.instructions
						.map(step => `<li>${step}</li>`)
						.join('');

					// Fetch reviews
					const reviewsResponse = await fetch(`/api/recipes/${recipeId}/reviews`);
					const reviewsData = await reviewsResponse.json();

					// Populate reviews
					const reviewsContainer = document.getElementById('reviews-container');
					reviewsContainer.innerHTML = reviewsData.length
						? reviewsData
							.map(review => `
								<div class="review">
									<strong>${review.user} - ${review.rating}/5</strong>
									<p>${review.review_text}</p>
								</div>
							`)
							.join('')
						: '<p>No reviews yet.</p>';
				} catch (error) {
					console.error('Error fetching recipe data:', error);
					document.getElementById('recipe-title').textContent = 'Error loading recipe';
				}
			}

			// Load recipe data on page load
			window.onload = fetchRecipeData;
		</script>
	</body>
</html>
